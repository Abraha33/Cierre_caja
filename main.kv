#:kivy 2.1.0

<MainScreen>:
    MDBoxLayout:
        orientation: 'horizontal'
        md_bg_color: app.theme_cls.primary_light
        
        # Barra superior
        MDTopAppBar:
            title: "üìÑ Gestor de Recibos"
            title_font_size: "20sp"
            elevation: 8
            md_bg_color: app.theme_cls.primary_color
            specific_text_color: 1, 1, 1, 1
            right_action_items: [["camera", lambda x: root.open_camera()], ["draw", lambda x: root.open_signature()], ["content-save", lambda x: root.save_receipt()]]
        
        # Contenido principal - Layout de dos columnas
        MDBoxLayout:
            orientation: 'horizontal'
            spacing: '0dp'
            
            # COLUMNA IZQUIERDA - Formulario
            MDBoxLayout:
                orientation: 'vertical'
                size_hint_x: 0.6
                padding: '20dp'
                spacing: '16dp'
                
                # Indicador de progreso
                MDCard:
                    size_hint_y: None
                    height: "80dp"
                    padding: "16dp"
                    elevation: 4
                    md_bg_color: app.theme_cls.primary_light
                    radius: [20, 20, 20, 20]
                    
                    MDBoxLayout:
                        orientation: 'horizontal'
                        spacing: '8dp'
                        
                        MDIcon:
                            icon: "1-circle" if root.current_step == 1 else "1-circle-outline"
                            theme_text_color: "Custom"
                            text_color: app.theme_cls.primary_color if root.current_step == 1 else (.5, .5, .5, 1)
                            size_hint_x: None
                            width: "32dp"
                        MDSeparator:
                            orientation: 'vertical'
                            height: "32dp"
                            color: app.theme_cls.primary_color
                        MDIcon:
                            icon: "2-circle" if root.current_step == 2 else "2-circle-outline"
                            theme_text_color: "Custom"
                            text_color: app.theme_cls.primary_color if root.current_step == 2 else (.5, .5, .5, 1)
                            size_hint_x: None
                            width: "32dp"
                        MDSeparator:
                            orientation: 'vertical'
                            height: "32dp"
                            color: app.theme_cls.primary_color
                        MDIcon:
                            icon: "3-circle" if root.current_step == 3 else "3-circle-outline"
                            theme_text_color: "Custom"
                            text_color: app.theme_cls.primary_color if root.current_step == 3 else (.5, .5, .5, 1)
                            size_hint_x: None
                            width: "32dp"
                        
                # PASO 1: Informaci√≥n B√°sica
                MDCard:
                    id: step1_card
                    size_hint_y: None
                    height: "200dp"
                    padding: "20dp"
                    elevation: 6
                    md_bg_color: 1, 1, 1, 1
                    
                    MDBoxLayout:
                        orientation: 'vertical'
                        spacing: '16dp'
                        
                        MDLabel:
                            text: "üèÅ Paso 1: Informaci√≥n B√°sica"
                            halign: "center"
                            font_style: "H6"
                            theme_text_color: "Primary"
                            size_hint_y: None
                            height: self.texture_size[1]
                        
                        # Fecha (autom√°tica)
                        MDTextField:
                            id: fecha_field
                            hint_text: "üìÖ Fecha"
                            text: "2024-01-15"
                            helper_text: "Fecha autom√°tica del sistema"
                            helper_text_mode: "on_focus"
                            readonly: True
                            icon_right: "calendar"
                            icon_right_color: app.theme_cls.primary_color
                        
                        # Monto
                        MDTextField:
                            id: monto_field
                            hint_text: "üí∞ Monto"
                            input_filter: "float"
                            helper_text: "Ingrese el monto en n√∫meros"
                            helper_text_mode: "on_focus"
                            icon_right: "currency-usd"
                            icon_right_color: app.theme_cls.primary_color
                            on_text: root.update_preview()
                
                # PASO 2: Clasificaci√≥n
                MDCard:
                    id: step2_card
                    size_hint_y: None
                    height: "280dp"
                    padding: "20dp"
                    elevation: 6
                    md_bg_color: 1, 1, 1, 1
                    
                    MDBoxLayout:
                        orientation: 'vertical'
                        spacing: '16dp'
                        
                        MDLabel:
                            text: "üè∑Ô∏è Paso 2: Clasificaci√≥n"
                            halign: "center"
                            font_style: "H6"
                            theme_text_color: "Primary"
                            size_hint_y: None
                            height: self.texture_size[1]
                        
                        # Tipo de uso
                        MDLabel:
                            text: "Tipo de Uso:"
                            size_hint_y: None
                            height: self.texture_size[1]
                            theme_text_color: "Secondary"
                        
                        Spinner:
                            id: uso_spinner
                            text: "Seleccionar uso"
                            values: ["Pago", "Gasto", "Devoluci√≥n"]
                            size_hint_y: None
                            height: "48dp"
                            background_color: app.theme_cls.primary_color
                            color: 1, 1, 1, 1
                            on_text: root.on_uso_selected(self, self.text)
                        
                        # Concepto (din√°mico seg√∫n uso)
                        MDLabel:
                            text: "Concepto:"
                            size_hint_y: None
                            height: self.texture_size[1]
                            theme_text_color: "Secondary"
                        
                        Spinner:
                            id: concepto_spinner
                            text: "Seleccionar concepto"
                            values: []
                            size_hint_y: None
                            height: "48dp"
                            background_color: app.theme_cls.primary_color
                            color: 1, 1, 1, 1
                            on_text: root.on_concepto_selected(self, self.text)
                        
                        # M√©todo de pago
                        MDLabel:
                            text: "M√©todo de Pago:"
                            size_hint_y: None
                            height: self.texture_size[1]
                            theme_text_color: "Secondary"
                        
                        Spinner:
                            id: metodo_spinner
                            text: "Seleccionar m√©todo"
                            values: ["Efectivo", "Transferencia", "Consignaci√≥n", "Nequi", "Daviplata", "Tarjeta"]
                            size_hint_y: None
                            height: "48dp"
                            background_color: app.theme_cls.primary_color
                            color: 1, 1, 1, 1
                            on_text: root.on_metodo_selected(self, self.text)
                
                # PASO 3: Detalles Espec√≠ficos
                MDCard:
                    id: step3_card
                    size_hint_y: None
                    height: "400dp"
                    padding: "20dp"
                    elevation: 6
                    md_bg_color: 1, 1, 1, 1
                    
                    MDBoxLayout:
                        orientation: 'vertical'
                        spacing: '16dp'
                        
                        MDLabel:
                            text: "üìù Paso 3: Detalles Espec√≠ficos"
                            halign: "center"
                            font_style: "H6"
                            theme_text_color: "Primary"
                            size_hint_y: None
                            height: self.texture_size[1]
                        
                        # Campos espec√≠ficos - se ocultan/muestran din√°micamente
                        MDTextField:
                            id: empleado_field
                            hint_text: "üë§ Empleado (para n√≥mina)"
                            disabled: True
                            helper_text: "Solo para n√≥mina"
                            helper_text_mode: "on_focus"
                            icon_right: "account"
                            icon_right_color: app.theme_cls.primary_color
                            on_text: root.update_preview()
                            opacity: 0
                            size_hint_y: None
                            height: 0
                        
                        MDTextField:
                            id: factura_field
                            hint_text: "üìÑ N√∫mero de Factura"
                            disabled: True
                            helper_text: "Para abonos y domicilios"
                            helper_text_mode: "on_focus"
                            icon_right: "file-document"
                            icon_right_color: app.theme_cls.primary_color
                            on_text: root.update_preview()
                            opacity: 0
                            size_hint_y: None
                            height: 0
                        
                        MDTextField:
                            id: empresa_domicilio_field
                            hint_text: "üè¢ Empresa Domiciliaria"
                            disabled: True
                            helper_text: "Solo para domicilios"
                            helper_text_mode: "on_focus"
                            icon_right: "office-building"
                            icon_right_color: app.theme_cls.primary_color
                            on_text: root.update_preview()
                            opacity: 0
                            size_hint_y: None
                            height: 0
                        
                        MDTextField:
                            id: costo_domicilio_field
                            hint_text: "üíµ Costo del Domicilio"
                            disabled: True
                            helper_text: "Solo para domicilios"
                            helper_text_mode: "on_focus"
                            input_filter: "float"
                            icon_right: "currency-usd"
                            icon_right_color: app.theme_cls.primary_color
                            on_text: root.update_preview()
                            opacity: 0
                            size_hint_y: None
                            height: 0
                        
                        MDTextField:
                            id: num_transaccion_field
                            hint_text: "üî¢ N√∫mero de Transacci√≥n"
                            disabled: True
                            helper_text: "Para transferencias y consignaciones"
                            helper_text_mode: "on_focus"
                            icon_right: "bank"
                            icon_right_color: app.theme_cls.primary_color
                            on_text: root.update_preview()
                            opacity: 0
                            size_hint_y: None
                            height: 0
                        
                        MDTextField:
                            id: banco_field
                            hint_text: "üè¶ Banco"
                            disabled: True
                            helper_text: "Para transferencias y consignaciones"
                            helper_text_mode: "on_focus"
                            icon_right: "bank"
                            icon_right_color: app.theme_cls.primary_color
                            on_text: root.update_preview()
                            opacity: 0
                            size_hint_y: None
                            height: 0
                        
                        # Mensaje cuando no hay campos espec√≠ficos
                        MDLabel:
                            id: no_specific_fields_label
                            text: "No se requieren campos adicionales para este concepto"
                            halign: "center"
                            theme_text_color: "Secondary"
                            size_hint_y: None
                            height: self.texture_size[1]
                            opacity: 1
                
                # Botones de navegaci√≥n
                MDBoxLayout:
                    orientation: 'horizontal'
                    size_hint_y: None
                    height: '60dp'
                    spacing: '16dp'
                    
                    MDRaisedButton:
                        text: "‚¨ÖÔ∏è Anterior"
                        on_release: root.previous_step()
                        size_hint_x: 0.5
                        md_bg_color: app.theme_cls.primary_light
                        text_color: 0, 0, 0, 1
                    
                    MDRaisedButton:
                        text: "Siguiente ‚û°Ô∏è"
                        on_release: root.next_step()
                        size_hint_x: 0.5
                        md_bg_color: app.theme_cls.accent_color
                        text_color: 1, 1, 1, 1
            
            # COLUMNA DERECHA - Previsualizaci√≥n en tiempo real
            MDBoxLayout:
                orientation: 'vertical'
                size_hint_x: 0.4
                padding: '20dp'
                spacing: '16dp'
                
                # T√≠tulo de previsualizaci√≥n
                MDCard:
                    size_hint_y: None
                    height: "80dp"
                    padding: "16dp"
                    elevation: 4
                    md_bg_color: app.theme_cls.accent_color
                    
                    MDLabel:
                        text: "üëÅÔ∏è Previsualizaci√≥n en Tiempo Real"
                        halign: "center"
                        font_style: "H5"
                        theme_text_color: "Custom"
                        text_color: 1, 1, 1, 1
                        size_hint_y: None
                        height: self.texture_size[1]
                
                # Previsualizaci√≥n mejorada
                MDCard:
                    size_hint_y: None
                    height: "420dp"
                    padding: "24dp"
                    elevation: 8
                    md_bg_color: 1, 1, 1, 1
                    radius: [20, 20, 20, 20]
                    shadow_radius: 16
                    shadow_offset: [0, 4]
                    
                    MDLabel:
                        text: "[b]Previsualizaci√≥n del Recibo[/b]"
                        markup: True
                        halign: "center"
                        font_style: "H6"
                        theme_text_color: "Primary"
                        size_hint_y: None
                        height: self.texture_size[1]
                    MDSeparator:
                        height: "2dp"
                        color: app.theme_cls.primary_color
                    ScrollView:
                        MDLabel:
                            id: preview_label
                            text: "Complete los campos para ver la previsualizaci√≥n"
                            halign: "left"
                            valign: "top"
                            size_hint_y: None
                            height: self.texture_size[1]
                            theme_text_color: "Secondary"
                            padding: "8dp"
                            markup: True
                
                # Secci√≥n de evidencias
                MDCard:
                    size_hint_y: None
                    height: "300dp"
                    padding: "20dp"
                    elevation: 6
                    md_bg_color: 1, 1, 1, 1
                    
                    MDBoxLayout:
                        orientation: 'vertical'
                        spacing: '16dp'
                        
                        MDLabel:
                            text: "üì∏ Evidencias"
                            halign: "center"
                            font_style: "H6"
                            theme_text_color: "Primary"
                            size_hint_y: None
                            height: self.texture_size[1]
                        
                        # Im√°genes capturadas
                        MDBoxLayout:
                            orientation: 'horizontal'
                            spacing: '16dp'
                            size_hint_y: None
                            height: "120dp"
                            
                            MDBoxLayout:
                                orientation: 'vertical'
                                spacing: '8dp'
                                size_hint_x: 0.5
                                
                                MDLabel:
                                    text: "üì∑ Imagen:"
                                    size_hint_y: None
                                    height: self.texture_size[1]
                                    theme_text_color: "Secondary"
                                
                                Image:
                                    id: image_preview
                                    size_hint_y: None
                                    height: "80dp"
                                    fit_mode: "contain"
                            
                            MDBoxLayout:
                                orientation: 'vertical'
                                spacing: '8dp'
                                size_hint_x: 0.5
                                
                                MDLabel:
                                    text: "‚úçÔ∏è Firma:"
                                    size_hint_y: None
                                    height: self.texture_size[1]
                                    theme_text_color: "Secondary"
                                
                                Image:
                                    id: signature_preview
                                    size_hint_y: None
                                    height: "80dp"
                                    fit_mode: "contain"
                
                # Botones de acci√≥n mejorados
                MDBoxLayout:
                    orientation: 'horizontal'
                    size_hint_y: None
                    height: '70dp'
                    spacing: '24dp'
                    padding: '8dp'
                    
                    MDRaisedButton:
                        text: "üìÑ Generar PDF"
                        on_release: root.generate_pdf()
                        size_hint_x: 0.5
                        md_bg_color: app.theme_cls.accent_color
                        text_color: 1, 1, 1, 1
                        font_size: "18sp"
                        elevation: 4
                    MDRaisedButton:
                        text: "üóëÔ∏è Limpiar"
                        on_release: root.clear_form()
                        size_hint_x: 0.5
                        md_bg_color: app.theme_cls.error_color
                        text_color: 1, 1, 1, 1
                        font_size: "18sp"
                        elevation: 4

<SignatureScreen>:
    MDBoxLayout:
        orientation: 'vertical'
        md_bg_color: app.theme_cls.primary_light
        
        # Barra superior mejorada
        MDTopAppBar:
            title: "‚úçÔ∏è Capturar Firma"
            title_font_size: "18sp"
            left_action_items: [["arrow-left", lambda x: setattr(root.manager, 'current', 'main')]]
            elevation: 8
            md_bg_color: app.theme_cls.primary_color
            specific_text_color: 1, 1, 1, 1
        
        # Contenido principal
        MDBoxLayout:
            orientation: 'vertical'
            padding: '24dp'
            spacing: '20dp'
            
            # T√≠tulo de la secci√≥n
            MDCard:
                size_hint_y: None
                height: "80dp"
                padding: "16dp"
                elevation: 4
                md_bg_color: app.theme_cls.primary_color
                
                MDLabel:
                    text: "‚úçÔ∏è Dibuja tu Firma"
                    halign: "center"
                    font_style: "H5"
                    theme_text_color: "Custom"
                    text_color: 1, 1, 1, 1
                    size_hint_y: None
                    height: self.texture_size[1]
            
            # √Årea de firma mejorada
            MDCard:
                size_hint_y: None
                height: "400dp"
                padding: "20dp"
                elevation: 6
                md_bg_color: 1, 1, 1, 1
                
                MDBoxLayout:
                    orientation: 'vertical'
                    spacing: '16dp'
                    
                    MDLabel:
                        text: "üìù √Årea de Firma"
                        halign: "center"
                        font_style: "H6"
                        theme_text_color: "Primary"
                        size_hint_y: None
                        height: self.texture_size[1]
                    
                    # Widget de firma
                    Widget:
                        id: signature_container
                        size_hint_y: None
                        height: "280dp"
                        canvas.before:
                            Color:
                                rgba: 1, 1, 1, 1
                            Rectangle:
                                pos: self.pos
                                size: self.size
                        canvas.after:
                            Color:
                                rgba: app.theme_cls.primary_color
                            Line:
                                rectangle: self.x, self.y, self.width, self.height
                                width: 3
        
        # Botones inferiores mejorados
        MDBoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: '80dp'
            spacing: '16dp'
            padding: '16dp'
            md_bg_color: app.theme_cls.primary_color
            
            MDRaisedButton:
                text: "üóëÔ∏è Limpiar"
                on_release: root.clear_signature()
                size_hint_x: 0.33
                md_bg_color: app.theme_cls.error_color
                text_color: 1, 1, 1, 1
            
            MDRaisedButton:
                text: "üíæ Guardar"
                on_release: root.save_signature()
                size_hint_x: 0.33
                md_bg_color: app.theme_cls.accent_color
                text_color: 1, 1, 1, 1
            
            MDRaisedButton:
                text: "‚ùå Cancelar"
                on_release: setattr(root.manager, 'current', 'main')
                size_hint_x: 0.33
                md_bg_color: app.theme_cls.primary_light
                text_color: 0, 0, 0, 1

<CajaWizardScreen>:
    current_step: 1
    MDBoxLayout:
        orientation: 'vertical'
        md_bg_color: app.theme_cls.primary_light
        padding: '16dp'
        spacing: '16dp'

        # Barra superior
        MDTopAppBar:
            title: "Cierre de Caja"
            elevation: 8
            md_bg_color: app.theme_cls.primary_color
            specific_text_color: 1, 1, 1, 1

        # Stepper visual
        MDBoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: '60dp'
            spacing: '8dp'
            padding: '8dp'
            MDIcon:
                icon: "numeric-1-circle" if root.current_step == 1 else "numeric-1-circle-outline"
                theme_text_color: "Custom"
                text_color: app.theme_cls.primary_color if root.current_step == 1 else (.5, .5, .5, 1)
            MDSeparator:
                orientation: 'vertical'
                height: "32dp"
                color: app.theme_cls.primary_color
            MDIcon:
                icon: "numeric-2-circle" if root.current_step == 2 else "numeric-2-circle-outline"
                theme_text_color: "Custom"
                text_color: app.theme_cls.primary_color if root.current_step == 2 else (.5, .5, .5, 1)
            MDSeparator:
                orientation: 'vertical'
                height: "32dp"
                color: app.theme_cls.primary_color
            MDIcon:
                icon: "numeric-3-circle-outline"
                theme_text_color: "Custom"
                text_color: (.5, .5, .5, 1)

        # PASO 1: Base de caja
        MDCard:
            id: base_caja_card
            opacity: 1 if root.current_step == 1 else 0
            height: self.minimum_height if root.current_step == 1 else 0
            padding: '20dp'
            elevation: 6
            md_bg_color: 1, 1, 0.8, 1
            radius: [16, 16, 16, 16]
            orientation: 'vertical'
            spacing: '12dp'
            
            MDLabel:
                text: "[b]Base de caja inicial[/b]"
                markup: True
                halign: "center"
                font_style: "H6"
                theme_text_color: "Custom"
                text_color: 0.2, 0.2, 0.2, 1
                size_hint_y: None
                height: self.texture_size[1]
            MDSeparator:
                height: "2dp"
                color: app.theme_cls.primary_color
            # Tabla de billetes y monedas
            MDGridLayout:
                cols: 4
                spacing: '8dp'
                size_hint_y: None
                height: self.minimum_height
                MDLabel:
                    text: "Denominaci√≥n"
                    bold: True
                MDLabel:
                    text: "Cantidad"
                    bold: True
                MDLabel:
                    text: "Subtotal"
                    bold: True
                MDLabel:
                    text: "Tipo"
                    bold: True
                # Filas
                MDLabel:
                    text: "$100.000"
                MDTextField:
                    id: b100k_field
                    input_filter: 'int'
                    on_text: root.update_base_caja()
                MDLabel:
                    id: b100k_subtotal
                    text: "$0"
                MDLabel:
                    text: "Billete"
                MDLabel:
                    text: "$50.000"
                MDTextField:
                    id: b50k_field
                    input_filter: 'int'
                    on_text: root.update_base_caja()
                MDLabel:
                    id: b50k_subtotal
                    text: "$0"
                MDLabel:
                    text: "Billete"
                MDLabel:
                    text: "$20.000"
                MDTextField:
                    id: b20k_field
                    input_filter: 'int'
                    on_text: root.update_base_caja()
                MDLabel:
                    id: b20k_subtotal
                    text: "$0"
                MDLabel:
                    text: "Billete"
                MDLabel:
                    text: "$10.000"
                MDTextField:
                    id: b10k_field
                    input_filter: 'int'
                    on_text: root.update_base_caja()
                MDLabel:
                    id: b10k_subtotal
                    text: "$0"
                MDLabel:
                    text: "Billete"
                MDLabel:
                    text: "$5.000"
                MDTextField:
                    id: b5k_field
                    input_filter: 'int'
                    on_text: root.update_base_caja()
                MDLabel:
                    id: b5k_subtotal
                    text: "$0"
                MDLabel:
                    text: "Billete"
                MDLabel:
                    text: "$2.000"
                MDTextField:
                    id: b2k_field
                    input_filter: 'int'
                    on_text: root.update_base_caja()
                MDLabel:
                    id: b2k_subtotal
                    text: "$0"
                MDLabel:
                    text: "Billete"
                MDLabel:
                    text: "$1.000"
                MDTextField:
                    id: b1k_field
                    input_filter: 'int'
                    on_text: root.update_base_caja()
                MDLabel:
                    id: b1k_subtotal
                    text: "$0"
                MDLabel:
                    text: "Billete"
                MDLabel:
                    text: "$500"
                MDTextField:
                    id: m500_field
                    input_filter: 'int'
                    on_text: root.update_base_caja()
                MDLabel:
                    id: m500_subtotal
                    text: "$0"
                MDLabel:
                    text: "Moneda"
                MDLabel:
                    text: "$200"
                MDTextField:
                    id: m200_field
                    input_filter: 'int'
                    on_text: root.update_base_caja()
                MDLabel:
                    id: m200_subtotal
                    text: "$0"
                MDLabel:
                    text: "Moneda"
                MDLabel:
                    text: "$100"
                MDTextField:
                    id: m100_field
                    input_filter: 'int'
                    on_text: root.update_base_caja()
                MDLabel:
                    id: m100_subtotal
                    text: "$0"
                MDLabel:
                    text: "Moneda"
                MDLabel:
                    text: "$50"
                MDTextField:
                    id: m50_field
                    input_filter: 'int'
                    on_text: root.update_base_caja()
                MDLabel:
                    id: m50_subtotal
                    text: "$0"
                MDLabel:
                    text: "Moneda"
            MDLabel:
                id: base_caja_total
                text: "[b]Total base de caja: $0[/b]"
                markup: True
                halign: "right"
                font_style: "Subtitle1"
                theme_text_color: "Custom"
                text_color: 0.1, 0.1, 0.1, 1
            MDRaisedButton:
                text: "Siguiente ‚û°Ô∏è"
                on_release: root.next_step()
                md_bg_color: app.theme_cls.accent_color
                text_color: 1, 1, 1, 1
                size_hint_x: 1
                font_size: "18sp"
                elevation: 4

        # PASO 2: Registro de movimientos
        MDCard:
            id: movimientos_card
            opacity: 1 if root.current_step == 2 else 0
            height: self.minimum_height if root.current_step == 2 else 0
            padding: '20dp'
            elevation: 6
            md_bg_color: 1, 1, 1, 1
            radius: [16, 16, 16, 16]
            orientation: 'vertical'
            spacing: '12dp'
            
            MDLabel:
                text: "[b]Registrar movimiento[/b]"
                markup: True
                halign: "center"
                font_style: "H6"
                theme_text_color: "Primary"
                size_hint_y: None
                height: self.texture_size[1]
            MDSeparator:
                height: "2dp"
                color: app.theme_cls.primary_color
            # Botones de tipo de movimiento
            MDBoxLayout:
                orientation: 'horizontal'
                spacing: '8dp'
                size_hint_y: None
                height: '48dp'
                MDRaisedButton:
                    text: "Pago"
                    on_release: root.set_tipo_movimiento('Pago')
                MDRaisedButton:
                    text: "Gasto"
                    on_release: root.set_tipo_movimiento('Gasto')
                MDRaisedButton:
                    text: "Devoluci√≥n"
                    on_release: root.set_tipo_movimiento('Devoluci√≥n')
                MDRaisedButton:
                    text: "Transferencia"
                    on_release: root.set_tipo_movimiento('Transferencia')
            # Formulario r√°pido de movimiento
            MDTextField:
                id: mov_concepto
                hint_text: "Concepto"
                helper_text: "Ej: Compra, abono, etc."
                helper_text_mode: "on_focus"
            MDTextField:
                id: mov_monto
                hint_text: "Monto"
                input_filter: 'float'
                helper_text: "Valor del movimiento"
                helper_text_mode: "on_focus"
            MDRaisedButton:
                text: "Agregar movimiento"
                on_release: root.agregar_movimiento()
                md_bg_color: app.theme_cls.primary_color
                text_color: 1, 1, 1, 1
                size_hint_x: 1
                font_size: "16sp"
                elevation: 2
            # Lista de movimientos
            MDLabel:
                text: "[b]Movimientos registrados:[/b]"
                markup: True
                font_style: "Subtitle1"
                theme_text_color: "Secondary"
            ScrollView:
                MDList:
                    id: movimientos_list
            MDLabel:
                id: movimientos_total
                text: "[b]Total movimientos: $0[/b]"
                markup: True
                halign: "right"
                font_style: "Subtitle1"
                theme_text_color: "Custom"
                text_color: 0.1, 0.1, 0.1, 1
            MDBoxLayout:
                orientation: 'horizontal'
                size_hint_y: None
                height: '48dp'
                spacing: '8dp'
                MDRaisedButton:
                    text: "‚¨ÖÔ∏è Anterior"
                    on_release: root.previous_step()
                    md_bg_color: app.theme_cls.primary_light
                    text_color: 0, 0, 0, 1
                    font_size: "16sp"
                MDRaisedButton:
                    text: "Siguiente ‚û°Ô∏è"
                    on_release: root.next_step()
                    md_bg_color: app.theme_cls.accent_color
                    text_color: 1, 1, 1, 1
                    font_size: "16sp" 